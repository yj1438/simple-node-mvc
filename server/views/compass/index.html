<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <title></title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            html, body{
                height: 100%;
            }
            body {
                font: 14px/1.5 Tahoma, Helvetica, Arial, sans-serif;
                -webkit-font-smoothing: antialiased;
                margin: 0;
            }
            #mask_tip, #main {
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                align-content: center;
                /* flex-direction: row; */
                display: -webkit-box;
                -webkit-box-pack: center;
                -webkit-box-align: center;
                background-color: rgba(0,0,0,0.7);
                color: #fff;
            }
            #main .plat {
                text-align: center;
            }
            #main img {
                width: 90%;
            }
        </style>
    </head>
    <body>
        <aside id="mask_tip">
            <div>
                <img src="/img/compass/shoushi.gif" />
                <p>将手机沿图示方向移动数次，以校准指南针</p>
            </div>
        </aside>

        <section id="main">
            <div class="plat"><img src="/img/compass/zhinanzhen.png" /></div>
        </section>

        <script>
            (function () {
                var calibration = false;            //是否已经校准
                var maxAcceleration = {
                    x: 0,
                    y: 0,
                    z: 0
                };
                window.addEventListener('deviceorientation', function (evt) {
                    var x = evt.alpha,
                        y = evt.beta,
                        z = evt.gamma;
                    var dom = document.querySelector('.plat');
                    dom.style.transform = 'rotateX(' + y + 'deg)'   
                        + ' rotateY(' + z + 'deg)' 
                        + ' rotateZ(' + x + 'deg)';     //ok
                    dom.style.webkitTransform = 'rotateX(' + y + 'deg)'   
                        + ' rotateY(' + z + 'deg)' 
                        + ' rotateZ(' + x + 'deg)';     //ok
                }, false);
                window.addEventListener('devicemotion', function (evt) {
                    if (calibration) {
                        return;
                    }
                    var _x = evt.acceleration.x,
                        _y = evt.acceleration.y,
                        _z = evt.acceleration.z;
                    maxAcceleration.x = Math.max(maxAcceleration.x, Math.abs(_x));
                    maxAcceleration.y = Math.max(maxAcceleration.y, Math.abs(_y));
                    maxAcceleration.z = Math.max(maxAcceleration.z, Math.abs(_z));
                    if (Math.min(maxAcceleration.x, maxAcceleration.y, maxAcceleration.z) > 15) {
                        calibration = true;
                        var dom = document.getElementById('mask_tip');
                        dom.remove();    
                    }
                }, false);
                //
                document.getElementById('mask_tip').addEventListener('click', function (evt) {
                    alert(maxAcceleration.x + '|' + maxAcceleration.y + '|' + maxAcceleration.z);
                }, false);
            })();
        </script>
    </body>
</html>