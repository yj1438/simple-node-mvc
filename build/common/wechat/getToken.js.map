{"version":3,"sources":["common/wechat/getToken.js"],"names":[],"mappings":"AAAA;;AAEA,IAAM,UAAU,QAAQ,SAAR,CAAhB;;AAEA,IAAI,YAAY,QAAQ,aAAR,CAAhB;;AAEA,IAAM,UAAU,QAAQ,UAAR,CAAhB;;AAEA,IAAM,YAAY,gFAAgF,QAAQ,MAAxF,GAAiG,UAAjG,GAA8G,QAAQ,UAAxI;;AAEA,SAAS,QAAT,CAAkB,QAAlB,EAA4B;AACxB,QAAM,QAAQ,KAAK,KAAL,CAAW,IAAI,IAAJ,GAAW,OAAX,KAAuB,IAAlC,CAAd;AACA,QAAI,QAAQ,UAAU,aAAtB,EAAqC;AACjC,gBAAQ,SAAR,EAAmB,UAAU,KAAV,EAAiB,QAAjB,EAA2B,IAA3B,EAAiC;AAChD,gBAAI,CAAC,KAAD,IAAU,SAAS,UAAT,KAAwB,GAAtC,EAA2C;AACvC,oBAAM,OAAO,KAAK,KAAL,CAAW,IAAX,CAAb;AACC,uBAAO,QAAP,KAAoB,UAArB,IAAoC,SAAS,KAAK,YAAd,CAApC;AACA,wBAAQ,GAAR,CAAY,IAAI,IAAJ,KAAa,YAAzB;AACA,wBAAQ,GAAR,CAAY,IAAZ;AACA,0BAAU,QAAV,CAAmB,IAAnB;AACH,aAND,MAMO;AACH,yBAAS,IAAT;AACH;AACJ,SAVD;AAWH,KAZD,MAYO;AACF,eAAO,QAAP,KAAoB,UAArB,IAAoC,SAAS,UAAU,KAAnB,CAApC;AACH;AACJ;;AAED,OAAO,OAAP,GAAiB,QAAjB","file":"common/wechat/getToken.js","sourcesContent":["'use strict';\n\nconst request = require('request');\n\nlet DataCache = require('./DataCache');\n\nconst APP_KEY = require('./AppKey'); \n\nconst TOKEN_URL = 'https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=' + APP_KEY.APP_ID + '&secret=' + APP_KEY.APP_SECRET;\n\nfunction getToken(callback) {\n    const nowTs = Math.floor(new Date().getTime() / 1000);\n    if (nowTs > DataCache.token_expries) {\n        request(TOKEN_URL, function (error, response, body) {\n            if (!error && response.statusCode === 200) {\n                const data = JSON.parse(body);\n                (typeof callback === 'function') && callback(data.access_token);\n                console.log(new Date() + '：获取新的token');\n                console.log(data);\n                DataCache.setToken(data);\n            } else {\n                callback(null);\n            }\n        });\n    } else {\n        (typeof callback === 'function') && callback(DataCache.token);\n    }\n}\n\nmodule.exports = getToken;"],"sourceRoot":"/source/"}