{"version":3,"sources":["controllers/uastatistics.old.js"],"names":[],"mappings":"AAAA;;;;;;;;;;;;AACA,IAAM,KAAK,QAAQ,IAAR,CAAX;AACA,IAAM,WAAW,QAAQ,UAAR,CAAjB;;AAEA;;;AAGA,SAAS,SAAT,CAAoB,QAApB,EAA8B;AAC1B,QAAI,aAAa,EAAjB;;AAEA,QAAI,OAAO,QAAP,KAAoB,UAAxB,EAAoC;AAChC;AACH;;AAED,QAAM,KAAK,SAAS,eAAT,CAAyB;AAChC,eAAO,GAAG,gBAAH,CAAoB,mBAApB;AADyB,KAAzB,CAAX;AAGA,OAAG,EAAH,CAAM,MAAN,EAAc,UAAC,IAAD,EAAU;AACpB,mBAAW,IAAX,CAAgB,KAAK,KAAL,CAAW,IAAX,CAAhB;AACH,KAFD,EAEG,EAFH,CAEM,OAFN,EAEe,YAAM;AACjB,iBAAS,UAAT;AACH,KAJD;AAKH;;AAED,QAAQ,MAAR,GAAiB,YAAY;AACzB,QAAI,OAAO,IAAX;AACA,cAAU,UAAU,IAAV,EAAgB;AACtB,YAAI,UAAU,EAAd;AADsB;AAAA;AAAA;;AAAA;AAEtB,4DAAkB,IAAlB,4GAAwB;AAAA,oBAAf,KAAe;;AACpB,wBAAQ,IAAR,CAAa,MAAM,MAAnB;AACH;AAJqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAKtB,WAAG,SAAH,CAAa,gBAAb,EAA+B,QAAQ,IAAR,CAAa,IAAb,CAA/B,EAAmD,MAAnD,EAA2D,UAAC,GAAD,EAAS;AAChE,gBAAI,GAAJ,EAAS;AACL,qBAAK,UAAL,CAAgB,GAAhB;AACH,aAFD,MAEO;AACH,qBAAK,UAAL,CAAgB,EAAC,OAAO,QAAQ,MAAhB,EAAhB;AACH;AACJ,SAND;AAOH,KAZD;AAaH,CAfD;;AAiBA;AACA,QAAQ,KAAR,GAAgB,YAAY;AACxB,SAAK,MAAL,CAAY,UAAZ,EAAwB,EAAxB;AACH,CAFD;;AAIA;AACA,QAAQ,OAAR,GAAkB,YAAY;AAC1B,QAAI,OAAO,IAAX;AACA,cAAW,UAAU,IAAV,EAAgB;AACvB,aAAK,UAAL,CAAgB,IAAhB;AACA;;;;;;;;;;AAUH,KAZD;AAaH,CAfD;;AAiBA;AACA,QAAQ,MAAR,GAAiB,YAAY;AACzB,QAAI,OAAO,IAAX;AACA,cAAW,UAAU,IAAV,EAAgB;AACvB,YAAI,aAAa,EAAjB;AAAA,YACI,QAAQ,KAAK,MADjB;AAAA,YAEI,aAAa,EAFjB;AADuB;AAAA;AAAA;;AAAA;AAIvB,6DAAkB,IAAlB,iHAAwB;AAAA,oBAAf,KAAe;;AACpB,oBAAI,CAAC,WAAW,MAAM,QAAjB,CAAL,EAAiC;AAC7B,+BAAW,MAAM,QAAjB,IAA6B,CAA7B;AACH;AACD,2BAAW,MAAM,QAAjB,IAA6B,WAAW,MAAM,QAAjB,IAA6B,CAA1D;AACH;AATsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAUvB,aAAK,IAAI,GAAT,IAAgB,UAAhB,EAA4B;AACxB,gBAAI,WAAW,cAAX,CAA0B,GAA1B,CAAJ,EAAoC;AAChC,2BAAW,IAAX,CAAgB;AACZ,0BAAM,GADM;AAEZ,yBAAK,WAAW,GAAX,CAFO;AAGZ,uBAAG,WAAW,CAAC,WAAW,GAAX,IAAkB,KAAnB,EAA0B,OAA1B,CAAkC,CAAlC,CAAX,IAAmD;AAH1C,iBAAhB;AAKH;AACJ;AACD,aAAK,MAAL,CAAY,WAAZ,EAAyB,EAAC,MAAM,yBAAe,UAAf,CAAP,EAAmC,OAAO,KAAK,MAA/C,EAAzB;AACR;AACK,KArBD;AAsBH,CAxBD","file":"controllers/uastatistics.old.js","sourcesContent":["'use strict';\nconst fs = require('fs');\nconst readline = require('readline');\n\n/**\n * 从数据文件中取数据\n */\nfunction getUAList (callback) {\n    let uaListData = [];\n    \n    if (typeof callback !== 'function') {\n        return;\n    }\n    \n    const rl = readline.createInterface({\n        input: fs.createReadStream('data/ua_data.json')\n    });\n    rl.on('line', (line) => {\n        uaListData.push(JSON.parse(line));\n    }).on('close', () => {\n        callback(uaListData);\n    });\n}\n\nexports.sortId = function () {\n    let self = this;\n    getUAList(function (data) {\n        let hashIds = [];\n        for (let value of data) {\n            hashIds.push(value.hashId);\n        }\n        fs.writeFile('data/hash.json', hashIds.join(\"\\n\"), 'utf8', (err) => {\n            if (err) {\n                self.renderJson(err);\n            } else {\n                self.renderJson({total: hashIds.length});\n            }\n        });\n    });\n};\n\n//统计 UA 列表页\nexports.index = function () {\n    this.render('ua/index', {});\n};\n\n//取列表 JSON 数据\nexports.getdata = function () {\n    let self = this;\n    getUAList (function (data) {\n        self.renderJson(data);\n        /*\n        {\n            isSuccess: true,\n            exhibitDatas: uaListData,\n            pageSize: params.pageSize,\n            nowPage: params.nowPage,\n            recordCount: uaListData.length,\n            pageCount: Math.ceil(uaListData.length / 20)\n        }\n        */\n    });\n};\n\n//统计 UA 图表页\nexports.charts = function () {\n    let self = this;\n    getUAList (function (data) {\n        let statistics = {},\n            total = data.length,\n            resultData = [];\n        for (let value of data) {\n            if (!statistics[value.protocol]) {\n                statistics[value.protocol] = 0;\n            }\n            statistics[value.protocol] = statistics[value.protocol] + 1;\n        }\n        for (let key in statistics) {\n            if (statistics.hasOwnProperty(key)) {\n                resultData.push({\n                    name: key,\n                    num: statistics[key],\n                    y: parseFloat((statistics[key] / total).toFixed(4)) * 100\n                });\n            }\n        }\n        self.render('ua/charts', {data: JSON.stringify(resultData), total: data.length});\n//        self.renderJson(statistics);\n    });\n};"],"sourceRoot":"/source/"}