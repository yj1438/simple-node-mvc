{"version":3,"sources":["controllers/uastatistics.js"],"names":[],"mappings":"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","file":"controllers/uastatistics.js","sourcesContent":["'use strict';\nconst http2Service = require('../service/http2Service'),\n      refService = require('../service/refService');\n\nexports.sortId = function () {\n};\n\n//统计 UA 列表页\nexports.index = function () {\n    this.render('ua/index', {});\n};\n\n//\"pageSize\":20,\"startRecord\":0,\"nowPage\":1, exhibitDatas, recordCount, pageCount, isSuccess\nexports.getdata = function () {\n    let _params = JSON.parse(this.params.dtGridPager);\n    let page = {\n        nowPage: _params.nowPage,\n        pageSize: _params.pageSize\n    };\n    http2Service.findPage(page, (err, rows) => {\n        if (err) {\n            console.log(err);\n            this.renderJson(Object.assign({}, _params, {isSuccess: false}));\n        } else {\n            let resultList = rows[0],\n                total = parseInt(rows[1][0].total, 10);\n            resultList.map((value, index) => {\n                value.is_spdy = value.is_spdy ? 'yes' : 'no';\n                return value;\n            });\n            let pageCount = Math.ceil(total / page.pageSize);\n            this.renderJson(Object.assign({}, _params, {isSuccess: true, exhibitDatas: rows[0], recordCount: total, pageCount: pageCount}));\n        }\n    });\n}\n\n//取列表 JSON 数据\nexports.getalldata = function () {\n    http2Service.findAll((err, rows) => {\n        if (err) {\n            console.log(err);\n            this.renderJson([]);\n        } else {\n            rows.map((value, index) => {\n                value.is_spdy = value.is_spdy ? 'yes' : 'no'\n                return value;\n            });\n            this.renderJson(rows);\n        }\n    });\n};\n\n//统计 UA 图表页\nexports.charts = function () {\n    const ref = this.params.ref ? decodeURIComponent(this.params.ref) : null;\n    //如果没有 ref 则统计全部\n    let total = 0,\n        resultData = [];\n    if (!ref) {\n        http2Service.countProtocal((err, rows) => {\n            if (err) {\n                console.error(err);\n                this.render('ua/charts', {data: null, total: 0});\n            } else {\n                //计算全部\n                for(let value of rows) {\n                    total = total + parseInt(value.num, 10);\n                    resultData.push({\n                        name: value.protocol,\n                        num: value.num\n                    });\n                }\n                resultData.map((value, index) => {\n                    value.y = (value.num / total).toFixed(4) * 100;\n                    return value;\n                });\n                this.render('ua/charts', {data: JSON.stringify(resultData), total: total});\n            }\n        });\n    } else {\n        refService.findByRef(ref, (err, rows) => {\n            if (err) {\n                console.error(err);\n                this.render('ua/charts', {data: null, total: 0});\n            } else {\n                if (rows.length === 0) {\n                    this.render('ua/charts', {data: null, total: 0});\n                } else {\n                    const _data = rows[0],\n                          _protocol = ['http1', 'spdy2', 'spdy3', 'spdy3_1', 'http2'];\n                    for (let p of _protocol) {\n                        if (!_data[p])\n                            continue;\n                        total = total + _data[p];\n                        resultData.push({\n                            name: p,\n                            num: _data[p]\n                        });\n                    }\n                    resultData.map((value, index) => {\n                        value.y = (value.num / total).toFixed(4) * 100;\n                        return value;\n                    });\n                    this.render('ua/charts', {data: JSON.stringify(resultData), total: total, ref: ref});\n                }\n            }\n        });\n    }\n};"],"sourceRoot":"/source/"}