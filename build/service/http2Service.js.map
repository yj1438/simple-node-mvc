{"version":3,"sources":["service/http2Service.js"],"names":[],"mappings":"AAAA;;;;;;;;AAEA,IAAM,WAAW,QAAQ,oBAAR,CAAjB;;AAEA;AACA,QAAQ,GAAR,GAAc,UAAS,IAAT,EAAe,QAAf,EAAyB;AACnC,aAAS,MAAT,CAAgB,8BAAhB,EAAgD,IAAhD,EAAsD,QAAtD;AACH,CAFD;;AAIA;AACA,QAAQ,YAAR,GAAuB,UAAS,MAAT,EAAiB,QAAjB,EAA2B;AAC9C,aAAS,MAAT,CAAgB,8CAAhB,EAAgE,MAAhE,EAAwE,QAAxE;AACH,CAFD;;AAIA;AACA,QAAQ,OAAR,GAAkB,UAAS,QAAT,EAAmB;AACjC,aAAS,MAAT,CAAgB,4BAAhB,EAA8C,IAA9C,EAAoD,QAApD;AACH,CAFD;;AAIA;AACA,QAAQ,aAAR,GAAwB,UAAS,QAAT,EAAmB;AACvC,aAAS,MAAT,CAAgB,0EAAhB,EAA4F,QAA5F;AACH,CAFD;;AAIA;AACA,QAAQ,QAAR,GAAmB,UAAS,IAAT,EAAe,QAAf,EAAyB;AACxC,QAAI,WAAW;AACX,iBAAS,IADE;AAEX,iBAAS,CAFE;AAGX,kBAAU;AAHC,KAAf;AAKA,eAAW,sBAAc,QAAd,EAAwB,IAAxB,CAAX;AACA,aAAS,MAAT,CAAgB,8GAAhB,EACgB,CAAC,SAAS,OAAV,EAAmB,CAAC,SAAS,OAAT,GAAmB,CAApB,IAAyB,SAAS,QAArD,EAA+D,SAAS,QAAxE,CADhB,EAEgB,QAFhB;AAGH,CAVD;;AAYA;AACA,QAAQ,MAAR,GAAiB,UAAS,MAAT,EAAiB,GAAjB,EAAsB,QAAtB,EAAgC;AAC7C,QAAI,OAAO,SAAS,GAAT,EAAc,EAAd,KAAqB,CAAhC;AACA,QAAI,YAAY,YAAY,YAAY,CAAE,CAA1C;AACA,aAAS,MAAT,CAAgB,yCAAyC,IAAzC,GAAgD,sBAAhE,EAAwF,MAAxF,EAAgG,SAAhG;AACH,CAJD","file":"service/http2Service.js","sourcesContent":["'use strict';\n\nconst Database = require('../common/database');\n\n//添加一条记录\nexports.add = function(data, callback) {\n    Database.handle('INSERT INTO statistics SET ?', data, callback);\n}\n\n//通过hashid查找记录\nexports.findByHashid = function(hashid, callback) {\n    Database.handle('SELECT * FROM statistics s WHERE s.hash_id=?', hashid, callback);\n}\n\n//查出全部\nexports.findAll = function(callback) {\n    Database.handle('SELECT * FROM statistics s', null, callback);\n}\n\n//协议统计\nexports.countProtocal = function(callback) {\n    Database.handle('SELECT s.protocol, count(*) AS num FROM statistics s group by s.protocol', callback);\n}\n\n//分页查询\nexports.findPage = function(page, callback) {\n    let defaults = {\n        orderby: 'id',\n        nowPage: 1,\n        pageSize: 20\n    };\n    defaults = Object.assign(defaults, page);\n    Database.handle('SELECT SQL_NO_CACHE SQL_CALC_FOUND_ROWS * FROM statistics order by ? limit ?,?; SELECT FOUND_ROWS() AS total', \n                    [defaults.orderby, (defaults.nowPage - 1) * defaults.pageSize, defaults.pageSize],\n                    callback);\n}\n\n//点击率加1\nexports.addCTR = function(hashid, CTR, callback) {\n    let _crt = parseInt(CTR, 10) || 1;\n    let _callback = callback || function () {};\n    Database.handle('UPDATE statistics s SET s.ctr=s.ctr+' + _crt + ' WHERE s.hash_id = ?', hashid, _callback);\n}\n"],"sourceRoot":"/source/"}